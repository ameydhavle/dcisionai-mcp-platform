<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DcisionAI Manufacturing Playground - Local Demo</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <i class="fas fa-cogs text-3xl"></i>
                    <div>
                        <h1 class="text-2xl font-bold">DcisionAI Manufacturing Playground</h1>
                        <p class="text-blue-100">Local Demo - Interactive Optimization Platform</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="bg-green-500 px-3 py-1 rounded-full text-sm">
                        <i class="fas fa-circle text-xs mr-1"></i>
                        Demo Mode
                    </span>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container mx-auto px-6 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Left Panel: Input & Configuration -->
            <div class="lg:col-span-1 space-y-6">
                
                <!-- Tenant Configuration -->
                <div class="bg-white rounded-lg shadow-lg p-6 card-hover">
                    <h3 class="text-lg font-semibold mb-4 flex items-center">
                        <i class="fas fa-user-tag text-blue-500 mr-2"></i>
                        Tenant Configuration
                    </h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Tenant ID</label>
                            <select id="tenantId" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="free_tenant">Free Tier</option>
                                <option value="pro_tenant">Pro Tier</option>
                                <option value="gold_tenant">Gold Tier</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">SLA Tier</label>
                            <select id="slaTier" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="free">Free</option>
                                <option value="pro">Pro</option>
                                <option value="gold">Gold</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Region</label>
                            <select id="region" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="us-east-1">US East (N. Virginia)</option>
                                <option value="us-west-2">US West (Oregon)</option>
                                <option value="eu-west-1">Europe (Ireland)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Optimization Input -->
                <div class="bg-white rounded-lg shadow-lg p-6 card-hover">
                    <h3 class="text-lg font-semibold mb-4 flex items-center">
                        <i class="fas fa-edit text-green-500 mr-2"></i>
                        Optimization Request
                    </h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Manufacturing Scenario</label>
                            <textarea id="optimizationPrompt" rows="4" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Describe your manufacturing optimization challenge...">Optimize production scheduling for 3 manufacturing lines to minimize costs while meeting customer demand for automotive parts</textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Quick Templates</label>
                            <div class="grid grid-cols-1 gap-2">
                                <button class="template-btn text-left p-3 border border-gray-200 rounded-lg hover:bg-blue-50 hover:border-blue-300 transition-all" data-template="scheduling">
                                    <div class="font-medium text-sm">Production Scheduling</div>
                                    <div class="text-xs text-gray-500">Optimize production schedules</div>
                                </button>
                                <button class="template-btn text-left p-3 border border-gray-200 rounded-lg hover:bg-blue-50 hover:border-blue-300 transition-all" data-template="quality">
                                    <div class="font-medium text-sm">Quality Optimization</div>
                                    <div class="text-xs text-gray-500">Improve product quality</div>
                                </button>
                                <button class="template-btn text-left p-3 border border-gray-200 rounded-lg hover:bg-blue-50 hover:border-blue-300 transition-all" data-template="supply_chain">
                                    <div class="font-medium text-sm">Supply Chain</div>
                                    <div class="text-xs text-gray-500">Minimize supply chain costs</div>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="bg-white rounded-lg shadow-lg p-6 card-hover">
                    <button id="runOptimization" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition-all flex items-center justify-center">
                        <i class="fas fa-play mr-2"></i>
                        Run Optimization
                    </button>
                    <button id="clearResults" class="w-full mt-3 bg-gray-500 hover:bg-gray-600 text-white font-semibold py-2 px-6 rounded-lg transition-all flex items-center justify-center">
                        <i class="fas fa-trash mr-2"></i>
                        Clear Results
                    </button>
                </div>

            </div>

            <!-- Right Panel: Results & Visualization -->
            <div class="lg:col-span-2 space-y-6">
                
                <!-- Status & Progress -->
                <div id="statusPanel" class="bg-white rounded-lg shadow-lg p-6 hidden">
                    <h3 class="text-lg font-semibold mb-4 flex items-center">
                        <i class="fas fa-tasks text-yellow-500 mr-2"></i>
                        Optimization Status
                    </h3>
                    <div id="progressContainer" class="space-y-4">
                        <!-- Progress will be dynamically added here -->
                    </div>
                </div>

                <!-- Results Tabs -->
                <div id="resultsPanel" class="bg-white rounded-lg shadow-lg hidden">
                    <div class="border-b border-gray-200">
                        <nav class="flex space-x-8 px-6">
                            <button class="tab-btn active py-4 px-1 border-b-2 border-blue-500 font-medium text-blue-600" data-tab="overview">
                                <i class="fas fa-chart-line mr-2"></i>Overview
                            </button>
                            <button class="tab-btn py-4 px-1 border-b-2 border-transparent font-medium text-gray-500 hover:text-gray-700" data-tab="intent">
                                <i class="fas fa-brain mr-2"></i>Intent Analysis
                            </button>
                            <button class="tab-btn py-4 px-1 border-b-2 border-transparent font-medium text-gray-500 hover:text-gray-700" data-tab="data">
                                <i class="fas fa-database mr-2"></i>Data Analysis
                            </button>
                            <button class="tab-btn py-4 px-1 border-b-2 border-transparent font-medium text-gray-500 hover:text-gray-700" data-tab="model">
                                <i class="fas fa-cube mr-2"></i>Model Building
                            </button>
                            <button class="tab-btn py-4 px-1 border-b-2 border-transparent font-medium text-gray-500 hover:text-gray-700" data-tab="solution">
                                <i class="fas fa-calculator mr-2"></i>Solution
                            </button>
                        </nav>
                    </div>
                    
                    <div class="p-6">
                        <!-- Overview Tab -->
                        <div id="overviewTab" class="tab-content">
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                                <div class="bg-blue-50 p-4 rounded-lg">
                                    <div class="text-2xl font-bold text-blue-600" id="overviewIntent">-</div>
                                    <div class="text-sm text-gray-600">Primary Intent</div>
                                </div>
                                <div class="bg-green-50 p-4 rounded-lg">
                                    <div class="text-2xl font-bold text-green-600" id="overviewConfidence">-</div>
                                    <div class="text-sm text-gray-600">Confidence</div>
                                </div>
                                <div class="bg-purple-50 p-4 rounded-lg">
                                    <div class="text-2xl font-bold text-purple-600" id="overviewVariables">-</div>
                                    <div class="text-sm text-gray-600">Decision Variables</div>
                                </div>
                                <div class="bg-orange-50 p-4 rounded-lg">
                                    <div class="text-2xl font-bold text-orange-600" id="overviewObjective">-</div>
                                    <div class="text-sm text-gray-600">Objective Value</div>
                                </div>
                            </div>
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <h4 class="font-semibold mb-2">Optimization Summary</h4>
                                <p id="overviewSummary" class="text-gray-700">Run an optimization to see results...</p>
                            </div>
                        </div>

                        <!-- Other tabs content would go here -->
                        <div id="intentTab" class="tab-content hidden">
                            <div class="text-center py-8">
                                <i class="fas fa-brain text-4xl text-gray-400 mb-4"></i>
                                <p class="text-gray-600">Intent Analysis results will appear here</p>
                            </div>
                        </div>

                        <div id="dataTab" class="tab-content hidden">
                            <div class="text-center py-8">
                                <i class="fas fa-database text-4xl text-gray-400 mb-4"></i>
                                <p class="text-gray-600">Data Analysis results will appear here</p>
                            </div>
                        </div>

                        <div id="modelTab" class="tab-content hidden">
                            <div class="text-center py-8">
                                <i class="fas fa-cube text-4xl text-gray-400 mb-4"></i>
                                <p class="text-gray-600">Model Building results will appear here</p>
                            </div>
                        </div>

                        <div id="solutionTab" class="tab-content hidden">
                            <div class="text-center py-8">
                                <i class="fas fa-calculator text-4xl text-gray-400 mb-4"></i>
                                <p class="text-gray-600">Solution results will appear here</p>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8 mt-12">
        <div class="container mx-auto px-6 text-center">
            <div class="flex items-center justify-center space-x-4 mb-4">
                <i class="fas fa-cogs text-2xl"></i>
                <span class="text-xl font-semibold">DcisionAI Manufacturing Platform</span>
            </div>
            <p class="text-gray-400">Local Demo - Powered by AWS Bedrock AgentCore & MCP Protocol</p>
            <div class="mt-4 flex justify-center space-x-6 text-sm text-gray-400">
                <span>Multi-tenant Architecture</span>
                <span>•</span>
                <span>Real-time Optimization</span>
                <span>•</span>
                <span>Production Ready</span>
            </div>
        </div>
    </footer>

    <script>
        // Global state
        let currentResults = null;
        let isRunning = false;

        // Template data
        const templates = {
            scheduling: "Optimize production scheduling for 3 manufacturing lines to minimize costs while meeting customer demand for automotive parts",
            quality: "Improve quality in assembly line by optimizing process parameters and reducing defect rates",
            supply_chain: "Minimize costs in supply chain operations while maintaining service levels and inventory optimization"
        };

        // Initialize the playground
        document.addEventListener('DOMContentLoaded', function() {
            initializeEventListeners();
            updateTenantConfiguration();
        });

        function initializeEventListeners() {
            // Template buttons
            document.querySelectorAll('.template-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const template = this.dataset.template;
                    document.getElementById('optimizationPrompt').value = templates[template];
                });
            });

            // Tenant configuration
            document.getElementById('tenantId').addEventListener('change', updateTenantConfiguration);
            document.getElementById('slaTier').addEventListener('change', updateTenantConfiguration);
            document.getElementById('region').addEventListener('change', updateTenantConfiguration);

            // Action buttons
            document.getElementById('runOptimization').addEventListener('click', runOptimization);
            document.getElementById('clearResults').addEventListener('click', clearResults);

            // Tab navigation
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    switchTab(this.dataset.tab);
                });
            });
        }

        function updateTenantConfiguration() {
            const tenantId = document.getElementById('tenantId').value;
            const slaTier = document.getElementById('slaTier').value;
            const region = document.getElementById('region').value;

            // Update SLA tier based on tenant selection
            if (tenantId === 'free_tenant') {
                document.getElementById('slaTier').value = 'free';
            } else if (tenantId === 'pro_tenant') {
                document.getElementById('slaTier').value = 'pro';
            } else if (tenantId === 'gold_tenant') {
                document.getElementById('slaTier').value = 'gold';
            }
        }

        async function runOptimization() {
            if (isRunning) return;

            const prompt = document.getElementById('optimizationPrompt').value.trim();
            if (!prompt) {
                alert('Please enter an optimization scenario');
                return;
            }

            isRunning = true;
            updateRunButton(true);

            // Show status panel
            document.getElementById('statusPanel').classList.remove('hidden');
            document.getElementById('resultsPanel').classList.add('hidden');

            // Clear previous progress
            document.getElementById('progressContainer').innerHTML = '';

            // Simulate optimization steps
            const steps = [
                { name: 'Intent Classification', icon: 'fas fa-brain', description: 'Analyzing manufacturing intent...' },
                { name: 'Data Analysis', icon: 'fas fa-database', description: 'Identifying data requirements...' },
                { name: 'Model Building', icon: 'fas fa-cube', description: 'Constructing optimization model...' },
                { name: 'Optimization Solving', icon: 'fas fa-calculator', description: 'Solving optimization problem...' }
            ];

            for (let i = 0; i < steps.length; i++) {
                const step = steps[i];
                const stepElement = createProgressStep(step, i === 0);
                document.getElementById('progressContainer').appendChild(stepElement);

                // Simulate processing time
                await new Promise(resolve => setTimeout(resolve, 1500 + Math.random() * 1000));

                // Mark step as completed
                stepElement.classList.remove('pulse-animation');
                stepElement.classList.add('bg-green-50', 'border-green-200');
                stepElement.querySelector('.step-icon').classList.remove('text-blue-500');
                stepElement.querySelector('.step-icon').classList.add('text-green-500');
                stepElement.querySelector('.step-status').textContent = 'Completed';
            }

            // Simulate API call to our AgentCore runtime
            try {
                const results = await simulateOptimizationCall(prompt);
                currentResults = results;
                displayResults(results);
            } catch (error) {
                console.error('Optimization failed:', error);
                alert('Optimization failed. Please try again.');
            } finally {
                isRunning = false;
                updateRunButton(false);
            }
        }

        function createProgressStep(step, isActive) {
            const stepElement = document.createElement('div');
            stepElement.className = `border rounded-lg p-4 ${isActive ? 'pulse-animation bg-blue-50 border-blue-200' : 'bg-gray-50 border-gray-200'}`;
            stepElement.innerHTML = `
                <div class="flex items-center space-x-3">
                    <div class="step-icon ${isActive ? 'text-blue-500' : 'text-gray-400'}">
                        <i class="${step.icon}"></i>
                    </div>
                    <div class="flex-1">
                        <div class="font-semibold">${step.name}</div>
                        <div class="text-sm text-gray-600">${step.description}</div>
                    </div>
                    <div class="step-status text-sm font-medium ${isActive ? 'text-blue-600' : 'text-gray-500'}">
                        ${isActive ? 'Running...' : 'Pending'}
                    </div>
                </div>
            `;
            return stepElement;
        }

        async function simulateOptimizationCall(prompt) {
            // Simulate API call to our AgentCore runtime
            // In production, this would call our actual MCP server
            
            // Simulate different results based on prompt content
            const isScheduling = prompt.toLowerCase().includes('scheduling') || prompt.toLowerCase().includes('schedule');
            const isQuality = prompt.toLowerCase().includes('quality') || prompt.toLowerCase().includes('defect');
            const isSupplyChain = prompt.toLowerCase().includes('supply') || prompt.toLowerCase().includes('chain');

            let primaryIntent, objectives, modelType, solver;
            
            if (isScheduling) {
                primaryIntent = 'production_scheduling';
                objectives = ['minimize_costs', 'meet_demand', 'maximize_efficiency'];
                modelType = 'linear_programming';
                solver = 'ortools';
            } else if (isQuality) {
                primaryIntent = 'quality_optimization';
                objectives = ['minimize_defects', 'maximize_quality', 'optimize_process_parameters'];
                modelType = 'nonlinear_programming';
                solver = 'highs';
            } else if (isSupplyChain) {
                primaryIntent = 'supply_chain_optimization';
                objectives = ['minimize_costs', 'maintain_service_levels', 'optimize_inventory'];
                modelType = 'mixed_integer_programming';
                solver = 'gurobi';
            } else {
                primaryIntent = 'general_optimization';
                objectives = ['minimize_costs', 'maximize_efficiency', 'meet_constraints'];
                modelType = 'linear_programming';
                solver = 'ortools';
            }

            return {
                success: true,
                workflow_results: {
                    intent_classification: {
                        primary_intent: primaryIntent,
                        confidence: 0.85 + Math.random() * 0.1,
                        objectives: objectives,
                        reasoning: `Classified as ${primaryIntent} based on keywords in query`,
                        inference_profile_used: 'dcisionai-pro-tier-production',
                        tenant_tier: document.getElementById('slaTier').value
                    },
                    data_analysis: {
                        data_entities: ['production_data', 'demand_forecasts', 'resource_constraints', 'quality_metrics'],
                        missing_data: [],
                        sample_data: {
                            production_capacity: 1000,
                            demand_forecast: 850,
                            defect_rate: 0.023,
                            cost_per_unit: 45.50
                        },
                        analysis: `Based on ${primaryIntent} intent analysis, identified 4 critical data requirements.`,
                        priority: 'high',
                        inference_profile_used: 'dcisionai-pro-tier-production',
                        tenant_tier: document.getElementById('slaTier').value,
                        data_complexity: 4,
                        estimated_data_volume: 5000
                    },
                    model_building: {
                        model_type: modelType,
                        decision_variables: 12 + Math.floor(Math.random() * 8),
                        constraints: 15 + Math.floor(Math.random() * 10),
                        complexity: 'medium',
                        inference_profile_used: 'dcisionai-pro-tier-production',
                        tenant_tier: document.getElementById('slaTier').value,
                        model_insights: `Necessary for ${primaryIntent} with complex business constraints`,
                        estimated_solve_time: '1.2-3.6 seconds',
                        scalability: 'Medium'
                    },
                    optimization_solving: {
                        status: 'optimal',
                        objective_value: 45000 + Math.random() * 10000,
                        solve_time: 1.5 + Math.random() * 2,
                        recommended_solver: solver,
                        available_solvers: [solver, 'ortools', 'highs'],
                        solution_quality: 'high',
                        inference_profile_used: 'dcisionai-pro-tier-production',
                        tenant_tier: document.getElementById('slaTier').value,
                        solver_insights: `${solver} solver provides optimal solution for this problem type`,
                        convergence_iterations: 150 + Math.floor(Math.random() * 100),
                        memory_usage_mb: 80 + Math.random() * 40,
                        optimization_metrics: {
                            gap: 0.01 + Math.random() * 0.05,
                            feasibility_tolerance: 1e-06,
                            optimality_tolerance: 1e-06
                        }
                    }
                },
                message: 'Manufacturing optimization workflow completed successfully',
                tools_used: ['manufacturing_intent_classifier', 'manufacturing_data_analyzer', 'manufacturing_model_builder', 'manufacturing_optimization_solver'],
                tenant_context: {
                    tenant_id: document.getElementById('tenantId').value,
                    sla_tier: document.getElementById('slaTier').value,
                    region: document.getElementById('region').value
                },
                inference_profiles_used: ['dcisionai-pro-tier-production', 'dcisionai-pro-tier-production', 'dcisionai-pro-tier-production', 'dcisionai-pro-tier-production'],
                mcp_protocol: {
                    version: '2024-11-05',
                    content_type: 'application/json',
                    session_id: 'playground-session'
                }
            };
        }

        function displayResults(results) {
            if (!results || !results.workflow_results) return;

            const workflow = results.workflow_results;
            
            // Update overview
            document.getElementById('overviewIntent').textContent = workflow.intent_classification.primary_intent.replace('_', ' ').toUpperCase();
            document.getElementById('overviewConfidence').textContent = (workflow.intent_classification.confidence * 100).toFixed(1) + '%';
            document.getElementById('overviewVariables').textContent = workflow.model_building.decision_variables;
            document.getElementById('overviewObjective').textContent = '$' + workflow.optimization_solving.objective_value.toLocaleString();
            document.getElementById('overviewSummary').textContent = results.message;

            // Show results panel
            document.getElementById('resultsPanel').classList.remove('hidden');
            document.getElementById('statusPanel').classList.add('hidden');
        }

        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active', 'border-blue-500', 'text-blue-600');
                btn.classList.add('border-transparent', 'text-gray-500');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active', 'border-blue-500', 'text-blue-600');
            document.querySelector(`[data-tab="${tabName}"]`).classList.remove('border-transparent', 'text-gray-500');

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            document.getElementById(tabName + 'Tab').classList.remove('hidden');
        }

        function updateRunButton(running) {
            const btn = document.getElementById('runOptimization');
            if (running) {
                btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Running...';
                btn.disabled = true;
                btn.classList.add('opacity-50', 'cursor-not-allowed');
            } else {
                btn.innerHTML = '<i class="fas fa-play mr-2"></i>Run Optimization';
                btn.disabled = false;
                btn.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        }

        function clearResults() {
            currentResults = null;
            document.getElementById('resultsPanel').classList.add('hidden');
            document.getElementById('statusPanel').classList.add('hidden');
            document.getElementById('optimizationPrompt').value = '';
        }
    </script>
</body>
</html>
