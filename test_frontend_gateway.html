<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Frontend AgentCore Gateway Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        pre { background-color: #f8f9fa; padding: 10px; border-radius: 5px; overflow-x: auto; }
        button { padding: 10px 20px; margin: 5px; background-color: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background-color: #0056b3; }
        button:disabled { background-color: #6c757d; cursor: not-allowed; }
    </style>
</head>
<body>
    <h1>Frontend AgentCore Gateway Test</h1>
    
    <div id="status" class="status info">Ready to test...</div>
    
    <div>
        <button onclick="testGatewayConnection()">Test Gateway Connection</button>
        <button onclick="testGetWorkflows()">Test Get Workflows</button>
        <button onclick="testGetManufacturingWorkflows()">Test Manufacturing Workflows</button>
    </div>
    
    <div id="results"></div>

    <script>
        const AGENTCORE_CONFIG = {
            gatewayUrl: "https://dcisionai-gateway-0de1a655-ja1rhlcqjx.gateway.bedrock-agentcore.us-east-1.amazonaws.com/mcp",
            accessToken: "eyJraWQiOiJLMWZEMFwvXC9qaGtJSHlZd2IyM2NsMkRSK0dEQ2tFaHVWZVd0djdFMERkOUk9IiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiI1cjdyaXJqdmI0OTZpam1rMDNtanNrNTNtOCIsInRva2VuX3VzZSI6ImFjY2VzcyIsInNjb3BlIjoiRGNpc2lvbkFJLUdhdGV3YXktMGRlMWE2NTVcL2ludm9rZSIsImF1dGhfdGltZSI6MTc2MDUzNzcxMSwiaXNzIjoiaHR0cHM6XC9cL2NvZ25pdG8taWRwLnVzLWVhc3QtMS5hbWF6b25hd3MuY29tXC91cy1lYXN0LTFfdjlDSmJRMWVKIiwiZXhwIjoxNzYwNTQxMzExLCJpYXQiOjE3NjA1Mzc3MTEsInZlcnNpb24iOjIsImp0aSI6IjQ1MDkzYTA2LWYzN2ItNDFlNy1iZmIzLWJkYjQwMzAwMzk3YyIsImNsaWVudF9pZCI6IjVyN3Jpcmp2YjQ5NmlqbWswM21qc2s1M204In0.nuR_XE9NDEq8wrIU8ON-u-4CrQusLh0OIfhDVUErLTu-PHuNpufybelGisROrZLpDol1ghXyyi3V0wkxa1qAkL6P1zDCbkE08spu_tQcQ2jSjwWKQLhUAI6AfUhwMWkrkysf35hDliexWgpdNVVEvlz2iM__WfY3ldX82Ut6XUun8-yWATdoluJoSAPI4dVm-QxkFHBF0DnDgr1T-d8DcgYEZxrOblUwHq73Rr50QCDQCXDazWkBLEC29XtxmrqFWguQbUrwSAQfZrQYqKLtPcQF0haBU9A0S_ZN3e90GJudKuGD4jAVYcSi0Mj0GmtGwMdM3Dckdzbt1DFhMQFOzg"
        };

        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
        }

        function addResult(title, content, type = 'info') {
            const resultsDiv = document.getElementById('results');
            const resultDiv = document.createElement('div');
            resultDiv.innerHTML = `
                <h3>${title}</h3>
                <pre>${JSON.stringify(content, null, 2)}</pre>
            `;
            resultDiv.className = `status ${type}`;
            resultsDiv.appendChild(resultDiv);
        }

        async function callGatewayTool(toolName, toolArguments) {
            const response = await fetch(AGENTCORE_CONFIG.gatewayUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${AGENTCORE_CONFIG.accessToken}`
                },
                body: JSON.stringify({
                    jsonrpc: '2.0',
                    id: Date.now(),
                    method: 'tools/call',
                    params: {
                        name: toolName,
                        arguments: toolArguments
                    }
                })
            });

            if (!response.ok) {
                throw new Error(`Gateway request failed: ${response.status} ${response.statusText}`);
            }

            const data = await response.json();

            if (data.error) {
                throw new Error(data.error.message || 'Gateway tool call failed');
            }

            // AgentCore Gateway wraps the actual Lambda response in a 'content' array
            if (data.result && data.result.content && data.result.content.length > 0) {
                const content = data.result.content[0].text;
                try {
                    const lambdaResponse = JSON.parse(content);
                    // The Lambda function returns a body which is also a stringified JSON
                    if (lambdaResponse.body) {
                        return JSON.parse(lambdaResponse.body);
                    }
                    return lambdaResponse;
                } catch (e) {
                    console.error("Failed to parse Lambda response from Gateway content:", e, content);
                    return { status: "error", message: "Failed to parse Lambda response from Gateway" };
                }
            }

            return data.result;
        }

        async function testGatewayConnection() {
            updateStatus('Testing Gateway connection...', 'info');
            try {
                const response = await fetch(AGENTCORE_CONFIG.gatewayUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${AGENTCORE_CONFIG.accessToken}`
                    },
                    body: JSON.stringify({
                        jsonrpc: '2.0',
                        id: Date.now(),
                        method: 'tools/list',
                        params: {}
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                if (data.error) {
                    throw new Error(data.error.message || 'Gateway list tools failed');
                }

                updateStatus('Gateway connection successful!', 'success');
                addResult('Gateway Tools List', data.result.tools, 'success');
            } catch (error) {
                updateStatus(`Gateway connection failed: ${error.message}`, 'error');
                addResult('Connection Error', { error: error.message }, 'error');
            }
        }

        async function testGetWorkflows() {
            updateStatus('Testing get_workflow_templates...', 'info');
            try {
                const result = await callGatewayTool('DcisionAI-Optimization-Tools-Fixed___get_workflow_templates', {});
                updateStatus('Get workflows successful!', 'success');
                addResult('All Workflows', result, 'success');
            } catch (error) {
                updateStatus(`Get workflows failed: ${error.message}`, 'error');
                addResult('Get Workflows Error', { error: error.message }, 'error');
            }
        }

        async function testGetManufacturingWorkflows() {
            updateStatus('Testing manufacturing workflows...', 'info');
            try {
                const result = await callGatewayTool('DcisionAI-Optimization-Tools-Fixed___get_workflow_templates', { industry: 'manufacturing' });
                updateStatus('Manufacturing workflows successful!', 'success');
                addResult('Manufacturing Workflows', result, 'success');
            } catch (error) {
                updateStatus(`Manufacturing workflows failed: ${error.message}`, 'error');
                addResult('Manufacturing Workflows Error', { error: error.message }, 'error');
            }
        }

        // Auto-test on page load
        window.onload = () => {
            testGatewayConnection();
        };
    </script>
</body>
</html>
