<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgentCore Gateway Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #1a1a1a;
            color: white;
        }
        .test-section {
            background-color: #2a2a2a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        button {
            background-color: #e07a4a;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #d2691e;
        }
        .result {
            background-color: #333;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            white-space: pre-wrap;
            font-family: monospace;
        }
        .success {
            border-left: 4px solid #4CAF50;
        }
        .error {
            border-left: 4px solid #f44336;
        }
    </style>
</head>
<body>
    <h1>AgentCore Gateway Connection Test</h1>
    
    <div class="test-section">
        <h2>Gateway Configuration</h2>
        <p><strong>Gateway URL:</strong> https://dcisionai-gateway-0de1a655-ja1rhlcqjx.gateway.bedrock-agentcore.us-east-1.amazonaws.com/mcp</p>
        <p><strong>Status:</strong> <span id="connection-status">Testing...</span></p>
    </div>

    <div class="test-section">
        <h2>Test Actions</h2>
        <button onclick="testConnection()">Test Connection</button>
        <button onclick="listTools()">List Tools</button>
        <button onclick="testWorkflowTemplates()">Test Workflow Templates</button>
        <button onclick="testOptimization()">Test Optimization</button>
    </div>

    <div class="test-section">
        <h2>Results</h2>
        <div id="results"></div>
    </div>

    <script>
        const GATEWAY_URL = 'https://dcisionai-gateway-0de1a655-ja1rhlcqjx.gateway.bedrock-agentcore.us-east-1.amazonaws.com/mcp';
        const ACCESS_TOKEN = 'eyJraWQiOiJLMWZEMFwvXC9qaGtJSHlZd2IyM2NsMkRSK0dEQ2tFaHVWZVd0djdFMERkOUk9IiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiI1cjdyaXJqdmI0OTZpam1rMDNtanNrNTNtOCIsInRva2VuX3VzZSI6ImFjY2VzcyIsInNjb3BlIjoiRGNpc2lvbkFJLUdhdGV3YXktMGRlMWE2NTVcL2ludm9rZSIsImF1dGhfdGltZSI6MTc2MDUzNzcxMSwiaXNzIjoiaHR0cHM6XC9cL2NvZ25pdG8taWRwLnVzLWVhc3QtMS5hbWF6b25hd3MuY29tXC91cy1lYXN0LTFfdjlDSmJRMWVKIiwiZXhwIjoxNzYwNTQxMzExLCJpYXQiOjE3NjA1Mzc3MTEsInZlcnNpb24iOjIsImp0aSI6IjQ1MDkzYTA2LWYzN2ItNDFlNy1iZmIzLWJkYjQwMzAwMzk3YyIsImNsaWVudF9pZCI6IjVyN3Jpcmp2YjQ5NmlqbWswM21qc2s1M204In0.nuR_XE9NDEq8wrIU8ON-u-4CrQusLh0OIfhDVUErLTu-PHuNpufybelGisROrZLpDol1ghXyyi3V0wkxa1qAkL6P1zDCbkE08spu_tQcQ2jSjwWKQLhUAI6AfUhwMWkrkysf35hDliexWgpdNVVEvlz2iM__WfY3ldX82Ut6XUun8-yWATdoluJoSAPI4dVm-QxkFHBF0DnDgr1T-d8DcgYEZxrOblUwHq73Rr50QCDQCXDazWkBLEC29XtxmrqFWguQbUrwSAQfZrQYqKLtPcQF0haBU9A0S_ZN3e90GJudKuGD4jAVYcSi0Mj0GmtGwMdM3Dckdzbt1DFhMQFOzg';

        function addResult(title, content, isError = false) {
            const resultsDiv = document.getElementById('results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `result ${isError ? 'error' : 'success'}`;
            resultDiv.innerHTML = `<strong>${title}</strong>\n${content}`;
            resultsDiv.appendChild(resultDiv);
        }

        async function makeGatewayCall(method, params = {}) {
            const response = await fetch(GATEWAY_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${ACCESS_TOKEN}`
                },
                body: JSON.stringify({
                    jsonrpc: '2.0',
                    id: Date.now(),
                    method: method,
                    params: params
                })
            });

            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }

            return await response.json();
        }

        async function testConnection() {
            try {
                addResult('Testing Connection', 'Attempting to connect to AgentCore Gateway...');
                const result = await makeGatewayCall('tools/list');
                
                if (result.result && result.result.tools) {
                    document.getElementById('connection-status').textContent = 'Connected';
                    document.getElementById('connection-status').style.color = '#4CAF50';
                    addResult('Connection Test', `Success! Found ${result.result.tools.length} tools available.`);
                } else {
                    throw new Error('Unexpected response format');
                }
            } catch (error) {
                document.getElementById('connection-status').textContent = 'Failed';
                document.getElementById('connection-status').style.color = '#f44336';
                addResult('Connection Test', `Error: ${error.message}`, true);
            }
        }

        async function listTools() {
            try {
                addResult('Listing Tools', 'Fetching available tools...');
                const result = await makeGatewayCall('tools/list');
                
                if (result.result && result.result.tools) {
                    const toolNames = result.result.tools.map(tool => tool.name).join('\n');
                    addResult('Available Tools', toolNames);
                } else {
                    throw new Error('No tools found');
                }
            } catch (error) {
                addResult('List Tools', `Error: ${error.message}`, true);
            }
        }

        async function testWorkflowTemplates() {
            try {
                addResult('Testing Workflow Templates', 'Fetching manufacturing workflows...');
                const result = await makeGatewayCall('tools/call', {
                    name: 'DcisionAI-Optimization-Tools-Fixed___get_workflow_templates',
                    arguments: {
                        industry: 'manufacturing'
                    }
                });
                
                addResult('Workflow Templates Test', JSON.stringify(result, null, 2));
            } catch (error) {
                addResult('Workflow Templates Test', `Error: ${error.message}`, true);
            }
        }

        async function testOptimization() {
            try {
                addResult('Testing Optimization', 'Running intent classification...');
                const result = await makeGatewayCall('tools/call', {
                    name: 'DcisionAI-Optimization-Tools-Fixed___classify_intent',
                    arguments: {
                        problem_description: 'Optimize production for 2 products with capacity constraints'
                    }
                });
                
                addResult('Optimization Test', JSON.stringify(result, null, 2));
            } catch (error) {
                addResult('Optimization Test', `Error: ${error.message}`, true);
            }
        }

        // Auto-test connection on page load
        window.onload = function() {
            testConnection();
        };
    </script>
</body>
</html>
